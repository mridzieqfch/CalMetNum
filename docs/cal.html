<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Regresi Linear Sederhana</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <!-- Font Awesome CDN for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Custom styles for better visual appeal */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font */
            background-color: #f3f4f6; /* Light gray background */
        }
        .data-input-container {
            max-height: 300px; /* Limit height for scrollable data inputs */
            overflow-y: auto; /* Enable vertical scrolling */
        }
        /* Style for scrollbar in webkit browsers */
        .data-input-container::-webkit-scrollbar {
            width: 8px;
        }
        .data-input-container::-webkit-scrollbar-track {
            background: #e5e7eb; /* Light gray track */
            border-radius: 10px;
        }
        .data-input-container::-webkit-scrollbar-thumb {
            background: #9ca3af; /* Darker gray thumb */
            border-radius: 10px;
        }
        .data-input-container::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* Even darker gray on hover */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl w-full max-w-5xl">
        <h1 class="text-3xl font-extrabold text-center mb-8 text-gray-900 leading-tight">
            Kalkulator Regresi Linear Sederhana
        </h1>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
            <!-- Input and Calculation Section -->
            <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
                <h2 class="text-2xl font-bold mb-5 text-gray-800">Input Data & Hitung</h2>

                <!-- Number of Data Input -->
                <div class="mb-5">
                    <label for="numData" class="block text-gray-700 text-sm font-semibold mb-2">
                        Input Pasangan Data (X, Y):
                    </label>
                    <div class="flex items-center space-x-3">
                        <input type="number" id="numData" min="1" value="3"
                               class="shadow-sm appearance-none border border-gray-300 rounded-lg w-24 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition duration-200 ease-in-out">
                        <button id="createInputs"
                                class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-5 rounded-lg shadow-md hover:shadow-lg transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-400">
                            Buat Input
                        </button>
                    </div>
                </div>

                <!-- Dynamic Data Input Fields -->
                <div id="dataInputs" class="data-input-container border border-gray-200 rounded-lg p-4 mb-6 bg-white shadow-sm">
                    <!-- Dynamic input fields will be added here by JavaScript -->
                </div>

                <!-- Calculate Button -->
                <button id="calculateBtn"
                        class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition duration-200 ease-in-out w-full focus:outline-none focus:ring-2 focus:ring-green-400">
                    <svg class="inline-block w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l-2 2a1 1 0 01-1.414 0l-1.414-1.414a1 1 0 010-1.414L7.586 1H17a1 1 0 011 1v17a1 1 0 01-1 1H9z"></path></svg>
                    Hitung Regresi
                </button>
            </div>

            <!-- Results and Prediction Section -->
            <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
                <h2 class="text-2xl font-bold mb-5 text-gray-800">Hasil & Prediksi</h2>

                <!-- Regression Results Display -->
                <div id="results" class="bg-white p-5 rounded-lg shadow mb-6 border border-gray-200">
                    <p class="text-gray-800 text-lg mb-3 font-semibold">
                        Persamaan Regresi: <span id="regressionEquation" class="font-normal text-blue-700">y = a + bx</span>
                    </p>
                    <p class="text-gray-700 mb-2">
                        <strong class="text-gray-800">Nilai Intercept (a):</strong>
                        <span id="interceptA" class="font-medium text-purple-700">0.0000</span>
                    </p>
                    <p class="text-gray-700">
                        <strong class="text-gray-800">Nilai Slope (b):</strong>
                        <span id="slopeB" class="font-medium text-purple-700">0.0000</span>
                    </p>
                </div>

                <!-- Prediction Input -->
                <div class="mb-5">
                    <label for="xPredict" class="block text-gray-700 text-sm font-semibold mb-2">
                        Masukkan Nilai X untuk Prediksi Y:
                    </label>
                    <input type="number" id="xPredict" placeholder="Contoh: 5"
                           class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent transition duration-200 ease-in-out">
                </div>

                <!-- Predict Button -->
                <button id="predictBtn"
                        class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition duration-200 ease-in-out w-full focus:outline-none focus:ring-2 focus:ring-purple-400">
                    <svg class="inline-block w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    Prediksi Y
                </button>

                <!-- Prediction Result Display -->
                <div id="predictionResult" class="bg-white p-5 rounded-lg shadow mt-6 border border-gray-200">
                    <p class="text-gray-800 text-md font-semibold">
                        Hasil Prediksi Y:
                        <span id="yPrediction" class="font-normal text-green-700">0.0000</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Chart Section -->
        <div class="mt-10 bg-gray-50 p-6 rounded-xl shadow-inner relative">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 text-center">Visualisasi Data & Garis Regresi</h2>
            <div class="bg-white p-4 rounded-lg shadow-md border border-gray-200">
                <canvas id="regressionChart" class="w-full h-80 md:h-96"></canvas>
            </div>
        </div>

        <!-- Message Box for Alerts -->
        <div id="messageBox" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
            <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
                <p id="messageText" class="text-lg text-gray-800 mb-4"></p>
                <button id="closeMessageBox" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-400">
                    Oke
                </button>
            </div>
        </div>
    </div>

    <!-- Tombol Reset Mengambang (Selalu terlihat dan melayang di pojok kanan bawah) -->
    <button id="resetBtn"
            class="fixed bottom-4 right-4 md:bottom-10 md:right-20 bg-gray-400 hover:bg-gray-500 text-white font-bold p-3 rounded-full shadow-lg transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-300 z-40">
        <i class="fas fa-sync-alt text-xl"></i>
    </button>

    <script>
        // Get references to HTML elements
        const numDataInput = document.getElementById('numData');
        const createInputsBtn = document.getElementById('createInputs');
        const dataInputsContainer = document.getElementById('dataInputs');
        const calculateBtn = document.getElementById('calculateBtn');
        const regressionEquationSpan = document.getElementById('regressionEquation');
        const interceptASpan = document.getElementById('interceptA');
        const slopeBSpan = document.getElementById('slopeB');
        const xPredictInput = document.getElementById('xPredict');
        const predictBtn = document.getElementById('predictBtn');
        const yPredictionSpan = document.getElementById('yPrediction');
        const chartCanvas = document.getElementById('regressionChart');
        const ctx = chartCanvas.getContext('2d');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const closeMessageBoxBtn = document.getElementById('closeMessageBox');
        const resetBtn = document.getElementById('resetBtn'); // Diubah menjadi satu tombol reset

        let regressionChart; // Variable to hold the Chart.js instance

        /**
         * Shows a custom message box instead of `alert()`.
         * @param {string} message - The message to display.
         */
        function showMessageBox(message) {
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
        }

        /**
         * Hides the custom message box.
         */
        closeMessageBoxBtn.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        /**
         * Creates or updates the input fields for X and Y data points
         * based on the number specified by the user.
         */
        function createDataInputFields() {
            const numData = parseInt(numDataInput.value);
            // Validate the number of data points
            if (isNaN(numData) || numData < 1) {
                showMessageBox('Jumlah data harus berupa angka positif.');
                numDataInput.value = 1; // Reset to default
                return;
            }

            dataInputsContainer.innerHTML = ''; // Clear existing input fields
            for (let i = 0; i < numData; i++) {
                const div = document.createElement('div');
                div.className = 'flex flex-col sm:flex-row gap-2 mb-2'; // Responsive layout for inputs
                div.innerHTML = `
                    <label class="block text-gray-600 text-sm font-medium pt-2 w-full sm:w-24 flex-shrink-0">Data ${i + 1}:</label>
                    <input type="number" placeholder="X" class="x-input shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-300 transition duration-200 ease-in-out" step="any">
                    <input type="number" placeholder="Y" class="y-input shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-300 transition duration-200 ease-in-out" step="any">
                `;
                dataInputsContainer.appendChild(div);
            }
        }

        // Initialize input fields when the page loads
        createDataInputFields();
        // Event listener for "Buat Input" button
        createInputsBtn.addEventListener('click', createDataInputFields);

        /**
         * Calculates the simple linear regression (slope 'b' and intercept 'a')
         * based on the input X and Y data points.
         */
        function calculateRegression() {
            const xInputs = document.querySelectorAll('.x-input');
            const yInputs = document.querySelectorAll('.y-input');

            // Extract values and convert to numbers
            const x = Array.from(xInputs).map(input => parseFloat(input.value));
            const y = Array.from(yInputs).map(input => parseFloat(input.value));
            const n = x.length;

            let sum_x = 0;
            let sum_y = 0;
            let sum_xy = 0;
            let sum_x2 = 0;

            // Check for valid numbers and calculate sums
            for (let i = 0; i < n; i++) {
                if (isNaN(x[i]) || isNaN(y[i])) {
                    showMessageBox('Harap masukkan angka untuk semua data X dan Y.');
                    return; // Exit if invalid input is found
                }
                sum_x += x[i];
                sum_y += y[i];
                sum_xy += x[i] * y[i];
                sum_x2 += x[i] * x[i];
            }

            // Calculate the denominator for slope 'b'
            const denominator = (n * sum_x2 - sum_x * sum_x);

            // Handle cases where regression cannot be calculated (e.g., all X values are the same)
            if (denominator === 0) {
                showMessageBox('Tidak dapat menghitung regresi. Variasi nilai X terlalu kecil atau semua nilai X sama.');
                // Reset displayed results
                regressionEquationSpan.textContent = 'y = a + bx';
                interceptASpan.textContent = '0.0000';
                slopeBSpan.textContent = '0.0000';
                // Clear the chart
                updateChart([], [], 0, 0);
                return;
            }

            // Calculate slope (b) and intercept (a)
            const b = (n * sum_xy - sum_x * sum_y) / denominator;
            const a = (sum_y - b * sum_x) / n;

            // Display the calculated results, formatted to 4 decimal places
            regressionEquationSpan.textContent = `y = ${a.toFixed(5)} + ${b.toFixed(5)}x`; // Changed to 5 decimal places
            interceptASpan.textContent = a.toFixed(5);
            slopeBSpan.textContent = b.toFixed(5);

            // Update the chart with new data and regression line
            updateChart(x, y, a, b);
        }

        // Event listener for "Hitung Regresi" button
        calculateBtn.addEventListener('click', calculateRegression);

        /**
         * Predicts the Y value based on a given X value and the calculated
         * regression parameters (a and b).
         */
        predictBtn.addEventListener('click', () => {
            const xPredict = parseFloat(xPredictInput.value);
            const a = parseFloat(interceptASpan.textContent); // Get 'a' from displayed result
            const b = parseFloat(slopeBSpan.textContent);     // Get 'b' from displayed result

            // Validate inputs for prediction
            if (isNaN(xPredict)) {
                showMessageBox('Harap masukkan nilai X untuk prediksi.');
                return;
            }
            if (isNaN(a) || isNaN(b) || (a === 0 && b === 0 && regressionEquationSpan.textContent === 'y = a + bx')) {
                showMessageBox('Harap hitung regresi terlebih dahulu sebelum melakukan prediksi.');
                return;
            }

            // Calculate predicted Y
            const yPredict = a + b * xPredict;
            // Display the predicted Y, formatted to 4 decimal places
            yPredictionSpan.textContent = yPredict.toFixed(5); // Changed to 5 decimal places
        });

        /**
         * Updates the Chart.js graph with new data points and the regression line.
         * @param {number[]} xData - Array of X values.
         * @param {number[]} yData - Array of Y values.
         * @param {number} a - The intercept value.
         * @param {number} b - The slope value.
         */
        function updateChart(xData, yData, a, b) {
            // Prepare data points for the scatter plot
            const dataPoints = xData.map((val, index) => ({ x: val, y: yData[index] }));

            // Determine min and max X values from the input data to draw the regression line across the data range
            const minX = xData.length > 0 ? Math.min(...xData) : 0;
            const maxX = xData.length > 0 ? Math.max(...xData) : 10; // Default max if no data

            // Calculate points for the regression line based on min and max X
            const regressionLinePoints = [
                { x: minX, y: a + b * minX },
                { x: maxX, y: a + b * maxX }
            ];

            // Destroy the existing chart instance if it exists to prevent memory leaks and conflicts
            if (regressionChart) {
                regressionChart.destroy();
            }

            // Create a new Chart.js instance
            regressionChart = new Chart(ctx, {
                type: 'scatter', // Main chart type is scatter for data points
                data: {
                    datasets: [{
                        label: 'Data Points',
                        data: dataPoints,
                        backgroundColor: 'rgba(75, 192, 192, 0.8)', // Teal color for points
                        borderColor: 'rgba(75, 192, 192, 1)',
                        pointRadius: 7, // Larger points for visibility
                        pointHoverRadius: 9,
                        pointBackgroundColor: 'rgba(75, 192, 192, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    },
                    {
                        label: 'Garis Regresi',
                        data: regressionLinePoints,
                        type: 'line', // This dataset is a line
                        fill: false,
                        borderColor: 'rgb(255, 99, 132)', // Red color for regression line
                        borderWidth: 3, // Thicker line
                        tension: 0.1, // Smoothness of the line (0 for straight)
                        pointRadius: 0, // Hide points on the line
                        pointHoverRadius: 0
                    }]
                },
                options: {
                    responsive: true, // Make chart responsive
                    maintainAspectRatio: false, // Do not maintain aspect ratio for flexible sizing
                    plugins: {
                        tooltip: {
                            callbacks: {
                                // Custom tooltip to display X and Y values
                                label: function(context) {
                                    return `(X: ${context.parsed.x.toFixed(2)}, Y: ${context.parsed.y.toFixed(2)})`;
                                }
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14
                                },
                                color: '#333'
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear', // X-axis is linear
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Nilai X', // X-axis label
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                color: '#555'
                            },
                            grid: {
                                borderColor: '#e0e0e0'
                            },
                            ticks: {
                                color: '#666'
                            }
                        },
                        y: {
                            type: 'linear', // Y-axis is linear
                            title: {
                                display: true,
                                text: 'Nilai Y', // Y-axis label
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                color: '#555'
                            },
                            grid: {
                                borderColor: '#e0e0e0'
                            },
                            ticks: {
                                color: '#666'
                            }
                        }
                    }
                }
            });
        }

        /**
         * Resets all inputs, results, and the chart to their initial state.
         */
        function resetCalculator() {
            numDataInput.value = 3; // Reset number of data points
            createDataInputFields(); // Re-create inputs with default 3 data points

            // Clear prediction input
            xPredictInput.value = '';

            // Reset regression results display
            regressionEquationSpan.textContent = 'y = a + bx';
            interceptASpan.textContent = '0.0000';
            slopeBSpan.textContent = '0.0000';
            yPredictionSpan.textContent = '0.0000';

            // Clear the chart
            updateChart([], [], 0, 0);

            // Re-populate with initial example data for 3 points
            // const initialX = [1, 2, 3];
            // const initialY = [2, 4, 5];

            const xInputs = document.querySelectorAll('.x-input');
            const yInputs = document.querySelectorAll('.y-input');

            initialX.forEach((val, idx) => {
                if (xInputs[idx]) xInputs[idx].value = val;
            });
            initialY.forEach((val, idx) => {
                if (yInputs[idx]) yInputs[idx].value = val;
            });

            calculateRegression(); // Recalculate regression for the reset data
        }

        // Initialize the chart with empty data on page load
        updateChart([], [], 0, 0);

        // Event listener for the single reset button
        resetBtn.addEventListener('click', resetCalculator);

        // Populate with initial example data for convenience
        window.onload = () => {
            resetCalculator(); // Call reset to initialize everything including data and chart
        };

    </script>
</body>
</html>