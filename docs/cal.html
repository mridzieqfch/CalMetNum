<!DOCTYPE html>
<html lang="id" class=""> <!-- Kelas 'dark' akan dikelola oleh JavaScript -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Regresi Linear</title>
    <!-- Memuat Font Awesome untuk ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Memuat Google Font 'Inter' -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Memuat Tailwind CSS dari CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Chart.js untuk visualisasi data -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script>
        // Konfigurasi Tailwind untuk mengaktifkan dark mode berdasarkan class
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .data-input-container { max-height: 300px; overflow-y: auto; }
        /* Kustomisasi scrollbar untuk Webkit (Chrome, Safari) */
        .data-input-container::-webkit-scrollbar { width: 8px; }
        .data-input-container::-webkit-scrollbar-track { background: #e5e7eb; border-radius: 10px; }
        .dark .data-input-container::-webkit-scrollbar-track { background: #374151; }
        .data-input-container::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 10px; }
        .dark .data-input-container::-webkit-scrollbar-thumb { background: #6b7280; }
        .data-input-container::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        .dark .data-input-container::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
    </style>
    <!-- Script untuk memeriksa tema. Defaultnya adalah light mode. -->
    <script>
        // Hanya aktifkan dark mode jika sudah dipilih secara eksplisit oleh pengguna sebelumnya.
        if (localStorage.theme === 'dark') {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
    </script>
</head>
<body class="bg-gray-100 dark:bg-slate-900 min-h-screen flex flex-col transition-colors duration-500">

    <!-- ===== HEADER ===== -->
    <header class="bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm sticky top-0 z-50 shadow-sm border-b border-gray-200 dark:border-gray-700 transition-colors duration-300">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <a href="index.html" class="text-xl font-bold text-gray-800 dark:text-white">Regression Teams</a>
                <div class="flex items-center space-x-2">
                    <a href="index.html" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none rounded-lg p-2.5 transition-colors duration-300" title="Kembali">
                        <i class="fas fa-circle-arrow-left text-xl"></i>
                    </a>
                    <button id="theme-toggle" type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none rounded-lg text-sm p-2.5 transition-colors duration-300">
                        <i id="theme-toggle-dark-icon" class="fas fa-moon hidden text-lg"></i>
                        <i id="theme-toggle-light-icon" class="fas fa-sun hidden text-lg"></i>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <main class="flex-grow container mx-auto p-4 md:p-8">
        <div class="bg-white dark:bg-slate-800 p-6 md:p-8 rounded-xl shadow-2xl w-full max-w-5xl mx-auto">
            <h1 class="text-3xl font-extrabold text-center mb-8 text-gray-900 dark:text-gray-50 leading-tight">
                Kalkulator Regresi Linear
            </h1>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
                <!-- Kolom Input & Perhitungan -->
                <div class="bg-gray-50 dark:bg-slate-900/50 p-6 rounded-lg shadow-inner">
                    <h2 class="text-2xl font-bold mb-5 text-gray-800 dark:text-gray-100">Input Data</h2>
                    <div class="mb-5">
                        <label for="numData" class="block text-gray-700 dark:text-gray-300 text-sm font-semibold mb-2">Jumlah Pasangan Data (X, Y):</label>
                        <div class="flex items-center space-x-3">
                            <input type="number" id="numData" min="2" value="3" class="shadow-sm appearance-none border border-gray-300 dark:border-gray-600 dark:bg-slate-700 dark:text-gray-200 rounded-lg w-24 py-2 px-3 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 dark:focus:ring-blue-500 transition">
                            <button id="createInputs" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-5 rounded-lg shadow-md hover:shadow-lg transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400">Buat</button>
                        </div>
                    </div>
                    <div id="dataInputs" class="data-input-container border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-6 bg-white dark:bg-slate-800 shadow-sm"></div>
                    <button id="calculateBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition w-full focus:outline-none focus:ring-2 focus:ring-green-400"><i class="fas fa-calculator mr-2"></i>Hitung Regresi</button>
                </div>

                <!-- Kolom Hasil & Prediksi -->
                <div class="bg-gray-50 dark:bg-slate-900/50 p-6 rounded-lg shadow-inner">
                    <h2 class="text-2xl font-bold mb-5 text-gray-800 dark:text-gray-100">Hasil & Prediksi</h2>
                    <div id="results" class="bg-white dark:bg-slate-800 p-5 rounded-lg shadow mb-6 border border-gray-200 dark:border-gray-700">
                        <p class="text-gray-800 dark:text-gray-200 text-lg mb-3 font-semibold">Persamaan: <span id="regressionEquation" class="font-normal text-blue-700 dark:text-sky-400">y = a + bx</span></p>
                        <p class="text-gray-700 dark:text-gray-300 mb-2"><strong class="dark:text-gray-100">Intercept (a):</strong> <span id="interceptA" class="font-medium text-purple-700 dark:text-purple-400">0.00000</span></p>
                        <p class="text-gray-700 dark:text-gray-300"><strong class="dark:text-gray-100">Slope (b):</strong> <span id="slopeB" class="font-medium text-purple-700 dark:text-purple-400">0.00000</span></p>
                    </div>
                    <div class="mb-5">
                        <label for="xPredict" class="block text-gray-700 dark:text-gray-300 text-sm font-semibold mb-2">Prediksi Y dari nilai X:</label>
                        <input type="number" id="xPredict" placeholder="Contoh: 5" class="shadow-sm appearance-none border border-gray-300 dark:border-gray-600 dark:bg-slate-700 dark:text-gray-200 rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-400 dark:focus:ring-purple-500 transition">
                    </div>
                    <button id="predictBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition w-full focus:outline-none focus:ring-2 focus:ring-purple-400"><i class="fas fa-lightbulb mr-2"></i>Prediksi</button>
                    <div id="predictionResult" class="bg-white dark:bg-slate-800 p-5 rounded-lg shadow mt-6 border border-gray-200 dark:border-gray-700">
                        <p class="text-gray-800 dark:text-gray-200 text-md font-semibold">Hasil Prediksi (Y): <span id="yPrediction" class="font-bold text-green-700 dark:text-green-400 text-md">0.00000</span></p>
                    </div>
                </div>
            </div>

            <!-- Bagian Grafik -->
            <div class="mt-10 bg-gray-50 dark:bg-slate-900/50 p-6 rounded-xl shadow-inner relative">
                <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100 text-center">Visualisasi Data</h2>
                <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 h-80 md:h-96">
                    <canvas id="regressionChart"></canvas>
                </div>
            </div>
            
            <!-- ===== BAGIAN KESIMPULAN BARU ===== -->
            <div id="conclusionSection" class="mt-8 bg-gray-50 dark:bg-slate-900/50 p-6 rounded-xl shadow-inner hidden">
                <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100 text-center">Kesimpulan Analisis</h2>
                <div id="conclusionText" class="text-gray-700 dark:text-gray-300 space-y-3 leading-relaxed text-base">
                    <!-- Kesimpulan dinamis akan dimasukkan di sini oleh JavaScript -->
                </div>
            </div>
            <!-- ===== AKHIR BAGIAN KESIMPULAN ===== -->
        </div>
    </main>
    
    <!-- Tombol Reset Mengambang -->
    <button id="resetBtn" class="fixed bottom-6 right-6 bg-red-600 hover:bg-red-700 text-white font-bold p-4 rounded-full shadow-lg transition transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-red-400 z-40" title="Reset Kalkulator"><i class="fas fa-sync-alt text-xl"></i></button>

    <!-- Kotak Pesan Kustom -->
    <div id="messageBox" class="fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white dark:bg-slate-700 p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <p id="messageText" class="text-lg text-gray-800 dark:text-gray-100 mb-4"></p>
            <button id="closeMessageBox" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400">Oke</button>
        </div>
    </div>

    <!-- ===== NEW FOOTER STARTS HERE ===== -->
    <footer class="bg-white dark:bg-slate-800/50 text-gray-600 dark:text-gray-400 shadow-inner mt-auto">
        <div class="container mx-auto px-4 sm:px-6 lg:px-5">
            <!-- Main Footer Content -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 py-12 text-center md:text-left">
                <!-- Branding Section -->
                <div>
                    <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2">Metode Numerik | Linear Regression</h3>
                    <p class="text-sm">Project Besar untuk mata kuliah Metode Numerik, berfokus pada implementasi dan visualisasi Algoritma Regresi linear.</p>
                </div>
                
                <!-- Spacer for middle column on large screens -->
                <div class="hidden lg:block"></div>

                <!-- Social Links Section -->
                <div class="flex flex-col items-center md:items-end">
                    <div class="flex space-x-5">
                        <a href="#" class="hover:text-sky-500 transition-colors duration-300 transform hover:-translate-y-1">
                            <!-- <i class="fab fa-github fa-2x"></i> -->
                        </a>
                        <a href="#" class="hover:text-sky-500 transition-colors duration-300 transform hover:-translate-y-1">
                            <!-- <i class="fab fa-instagram fa-2x"></i> -->
                            <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="55pt" height="60pt" viewBox="0 0 300.000000 113.000000" preserveAspectRatio="xMidYMid meet">
                            <g transform="translate(0.000000,113.000000) scale(0.100000,-0.100000)" class="fill-gray-800 dark:fill-gray-200 transition-colors duration-300">
                                <path d="M130 976 l0 -85 58 -11 c155 -30 346 -106 358 -142 3 -11 4 -21 1 -24 -2 -2 -33 9 -68 25 -59 27 -197 72 -261 86 -16 3 -28 12 -28 19 0 14 -21 26 -46 26 -12 0 -14 -10 -12 -42 3 -43 3 -43 49 -49 133 -19 353 -104 365 -141 3 -11 4 -21 2 -24 -2 -2 -40 12 -84 31 -43 19 -123 45 -176 57 -78 18 -98 27 -98 41 0 9 -6 17 -14 17 -8 0 -21 3 -30 6 -13 5 -16 -2 -16 -44 l0 -49 58 -6 c132 -15 327 -86 352 -129 21 -38 9 -42 -41 -14 -64 36 -164 71 -241 86 -45 8 -68 17 -68 26 0 8 -6 14 -14 14 -8 0 -21 3 -30 6 -13 5 -16 -2 -16 -38 l0 -45 68 -6 c89 -9 158 -29 265 -79 l87 -41 0 -137 0 -137 41 -51 42 -51 43 54 44 54 0 135 0 135 83 40 c92 45 170 68 264 77 l63 7 0 44 c0 37 -3 44 -16 39 -9 -3 -22 -6 -30 -6 -8 0 -14 -7 -14 -15 0 -9 -14 -16 -37 -20 -71 -12 -178 -47 -246 -81 l-67 -33 0 25 c0 22 10 30 73 59 86 40 195 72 278 81 l59 7 0 49 c0 42 -3 49 -16 44 -9 -3 -22 -6 -30 -6 -8 0 -14 -8 -14 -18 0 -15 -13 -22 -57 -31 -82 -17 -180 -50 -235 -77 -57 -29 -58 -29 -58 -5 0 11 10 27 23 36 54 38 294 114 360 115 26 0 27 3 27 46 0 43 -2 46 -22 40 -13 -3 -26 -6 -30 -6 -3 0 -8 -7 -10 -16 -2 -11 -31 -23 -94 -39 -50 -13 -126 -39 -169 -59 -43 -20 -79 -36 -81 -36 -2 0 -4 9 -4 20 0 11 11 27 25 36 60 39 215 90 363 120 21 4 22 9 22 90 0 85 0 86 -22 80 -13 -3 -26 -6 -30 -6 -5 0 -8 -26 -8 -57 l0 -58 -90 -22 c-102 -26 -250 -90 -250 -108 0 -7 -7 -18 -15 -25 -12 -10 -15 -10 -15 4 0 18 75 91 127 122 33 21 89 41 181 64 38 10 42 14 42 41 0 29 -1 30 -32 24 -84 -18 -217 -67 -254 -94 -22 -17 -53 -54 -69 -83 -27 -48 -30 -63 -33 -168 -2 -63 -8 -119 -12 -123 -4 -5 -17 -6 -29 -2 -20 6 -21 13 -21 118 0 91 -4 120 -21 157 -40 89 -99 129 -254 174 -49 14 -93 26 -97 26 -4 0 -8 -13 -8 -30 0 -26 5 -30 43 -40 118 -31 215 -77 248 -118 21 -27 18 -42 -4 -24 -21 18 -164 72 -240 91 l-72 19 -3 55 c-3 54 -13 66 -54 67 -5 0 -8 -38 -8 -84z m590 -382 c0 -3 -8 -19 -17 -34 -14 -24 -15 -33 -4 -56 8 -19 9 -30 1 -38 -7 -7 -10 -2 -10 17 0 20 -6 28 -25 33 -30 8 -33 30 -4 37 11 3 23 15 26 26 5 18 33 31 33 15z m-60 -115 c0 -30 -25 -46 -46 -28 -8 6 -14 21 -14 34 0 17 6 22 30 22 26 0 30 -4 30 -28z m30 -54 c0 -9 -9 -15 -25 -15 -29 0 -34 16 -7 23 30 8 32 7 32 -8z m-65 -35 c5 -8 11 -7 21 1 12 10 14 -4 14 -90 0 -56 -5 -111 -10 -121 -6 -12 -7 -21 0 -25 5 -3 7 -12 4 -20 -4 -8 -10 -13 -15 -10 -4 3 -6 11 -3 18 2 7 -4 22 -16 32 -18 16 -20 30 -20 122 0 94 7 121 25 93z"/>
                                <path d="M1250 890 c0 -100 0 -100 25 -100 25 0 25 0 25 100 0 100 0 100 -25 100 -25 0 -25 0 -25 -100z"/>
                                <path d="M1340 890 c0 -99 0 -100 25 -100 23 0 24 4 27 60 l3 61 45 -60 c34 -46 51 -61 70 -61 l25 0 0 100 c0 96 -1 100 -22 100 -20 0 -22 -6 -25 -62 l-3 -63 -48 63 c-36 46 -54 62 -73 62 -24 0 -24 -1 -24 -100z"/>
                                <path d="M1595 974 c-10 -10 -15 -29 -13 -48 2 -25 11 -35 41 -49 51 -26 51 -52 -2 -43 -31 5 -40 2 -45 -11 -9 -22 10 -33 60 -33 90 0 103 98 17 124 -13 4 -23 14 -23 23 0 12 7 14 29 10 29 -6 49 13 35 34 -9 15 -81 10 -99 -7z"/>
                                <path d="M1730 966 c0 -19 4 -23 20 -19 19 5 20 0 20 -76 0 -80 0 -81 25 -81 25 0 25 1 25 81 0 76 1 81 20 76 16 -4 20 0 20 19 0 23 -3 24 -65 24 -62 0 -65 -1 -65 -24z"/>
                                <path d="M1890 906 c0 -46 -3 -91 -6 -100 -5 -12 0 -16 20 -16 l26 0 0 100 c0 93 -1 100 -20 100 -18 0 -20 -7 -20 -84z"/>
                                <path d="M1960 966 c0 -19 4 -23 20 -19 19 5 20 0 20 -76 0 -80 0 -81 25 -81 25 0 25 1 25 81 0 76 1 81 20 76 16 -4 20 0 20 19 0 23 -3 24 -65 24 -62 0 -65 -1 -65 -24z"/>
                                <path d="M2120 910 c0 -98 15 -120 83 -120 65 0 80 22 83 120 3 79 3 80 -21 80 -24 0 -25 -3 -25 -64 0 -80 -6 -96 -35 -96 -33 0 -38 13 -36 91 2 68 1 69 -24 69 -25 0 -25 -1 -25 -80z"/>
                                <path d="M2310 966 c0 -19 4 -23 20 -19 19 5 20 0 20 -76 0 -80 0 -81 25 -81 25 0 25 1 25 81 0 76 1 81 20 76 16 -4 20 0 20 19 0 23 -3 24 -65 24 -62 0 -65 -1 -65 -24z"/>
                                <path d="M1230 653 c0 -18 6 -23 26 -23 l27 0 -7 -75 -7 -75 28 0 28 0 -3 75 -4 75 27 0 c21 0 26 4 23 21 -3 18 -10 21 -71 22 -63 2 -67 1 -67 -20z"/>
                                <path d="M1390 578 l0 -98 55 0 c48 0 55 2 55 20 0 16 -7 20 -30 20 -23 0 -30 4 -30 20 0 16 7 20 30 20 23 0 30 4 30 20 0 16 -7 20 -30 20 -20 0 -30 5 -30 15 0 10 10 15 30 15 24 0 30 4 30 23 0 20 -5 22 -55 22 l-55 0 0 -97z"/>
                                <path d="M1540 581 c0 -98 1 -101 23 -101 20 0 22 4 19 40 -2 22 0 40 4 40 5 0 22 -18 37 -40 22 -31 35 -40 58 -40 16 0 29 2 29 4 0 2 -18 26 -40 52 l-40 48 28 31 c56 61 58 65 22 62 -26 -2 -39 -11 -62 -44 -16 -24 -31 -43 -34 -43 -3 0 -4 19 -2 43 2 37 0 42 -20 45 -22 3 -22 1 -22 -97z"/>
                                <path d="M1740 579 c0 -98 0 -99 25 -99 23 0 24 4 27 60 l3 61 45 -60 c36 -49 51 -61 73 -61 l28 0 -3 98 c-3 92 -4 97 -25 100 -22 3 -23 0 -23 -57 0 -34 -3 -61 -7 -60 -5 0 -27 26 -49 57 -31 42 -49 57 -68 58 l-26 2 0 -99z"/>
                                <path d="M2033 670 c-51 -21 -72 -105 -39 -155 9 -13 33 -29 54 -36 106 -31 187 96 108 170 -27 25 -89 36 -123 21z m92 -60 c22 -24 14 -65 -16 -81 -52 -27 -106 29 -74 77 19 30 65 32 90 4z"/>
                                <path d="M2220 579 l0 -99 55 0 c48 0 55 2 55 20 0 16 -7 20 -30 20 l-30 0 0 79 c0 77 0 79 -25 79 -25 0 -25 -1 -25 -99z"/>
                                <path d="M2398 664 c-35 -19 -48 -43 -48 -92 0 -71 74 -117 143 -88 43 17 58 37 64 85 5 36 2 44 -30 76 -39 39 -81 46 -129 19z m94 -51 c36 -32 8 -93 -44 -93 -40 0 -65 69 -36 98 17 17 58 15 80 -5z"/>
                                <path d="M2644 670 c-33 -13 -54 -50 -54 -93 0 -51 15 -76 55 -93 64 -26 128 7 141 74 l7 32 -52 0 c-44 0 -51 -3 -51 -20 0 -14 7 -20 21 -20 30 0 18 -24 -15 -28 -15 -2 -34 2 -42 9 -19 15 -18 74 2 93 19 20 34 20 60 2 25 -18 65 -10 57 10 -13 34 -83 53 -129 34z"/>
                                <path d="M2820 580 c0 -100 0 -100 25 -100 25 0 25 0 25 100 0 100 0 100 -25 100 -25 0 -25 0 -25 -100z"/>
                                <path d="M1250 265 c0 -95 0 -95 25 -95 21 0 25 5 25 29 0 25 4 29 40 35 59 9 81 65 40 106 -15 15 -33 20 -75 20 l-55 0 0 -95z m95 30 c0 -13 -8 -21 -22 -23 -19 -3 -23 1 -23 23 0 22 4 26 23 23 14 -2 22 -10 22 -23z"/>
                                <path d="M1430 265 l0 -95 55 0 c48 0 55 2 55 20 0 16 -7 20 -35 20 l-35 0 7 75 6 75 -27 0 -26 0 0 -95z"/>
                                <path d="M1570 265 c0 -92 1 -95 23 -95 21 0 22 3 19 61 -2 34 0 59 5 56 4 -3 26 -30 48 -61 32 -44 46 -56 68 -56 l27 0 0 95 c0 95 0 95 -25 95 -24 0 -25 -3 -25 -62 l0 -62 -46 62 c-34 46 -52 62 -70 62 -24 0 -24 -1 -24 -95z"/>
                            </g>
                            </svg>
                        </a>
                        <a href="#" class="hover:text-sky-500 transition-colors duration-300 transform hover:-translate-y-1">
                              
                            <!-- <i class="fab fa-linkedin fa-2x"></i> -->
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Sub-Footer / Copyright Bar -->
            <div class="border-t border-gray-200 dark:border-gray-700 py-3">
                <p class="text-center text-sm">&copy; 2025 Institut Teknologi PLN. All Rights Reserved.</p>
            </div>
        </div>
    </footer>
    <!-- ===== NEW FOOTER ENDS HERE ===== -->

    <script>
        // --- Referensi Elemen DOM ---
        const numDataInput = document.getElementById('numData');
        const createInputsBtn = document.getElementById('createInputs');
        const dataInputsContainer = document.getElementById('dataInputs');
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const regressionEquationSpan = document.getElementById('regressionEquation');
        const interceptASpan = document.getElementById('interceptA');
        const slopeBSpan = document.getElementById('slopeB');
        const xPredictInput = document.getElementById('xPredict');
        const predictBtn = document.getElementById('predictBtn');
        const yPredictionSpan = document.getElementById('yPrediction');
        const chartCanvas = document.getElementById('regressionChart');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const closeMessageBoxBtn = document.getElementById('closeMessageBox');
        const conclusionSection = document.getElementById('conclusionSection');
        const conclusionTextEl = document.getElementById('conclusionText');
        
        // --- Logika Dark Mode ---
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
        const htmlElement = document.documentElement;

        let regressionChart;
        let lastChartData = { x: [], y: [], a: 0, b: 0 };

        function setIconVisibility() {
            if (htmlElement.classList.contains('dark')) {
                themeToggleLightIcon.classList.remove('hidden');
                themeToggleDarkIcon.classList.add('hidden');
            } else {
                themeToggleLightIcon.classList.add('hidden');
                themeToggleDarkIcon.classList.remove('hidden');
            }
        }

        themeToggleBtn.addEventListener('click', () => {
            htmlElement.classList.toggle('dark');
            localStorage.theme = htmlElement.classList.contains('dark') ? 'dark' : 'light';
            setIconVisibility();
            updateChart(lastChartData.x, lastChartData.y, lastChartData.a, lastChartData.b);
        });

        // --- Logika Kalkulator ---
        function showMessageBox(message) {
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
        }

        closeMessageBoxBtn.addEventListener('click', () => messageBox.classList.add('hidden'));

        function createDataInputFields() {
            const numData = parseInt(numDataInput.value);
            if (isNaN(numData) || numData < 2) {
                showMessageBox('Jumlah data minimal harus 2.');
                numDataInput.value = 2;
                return;
            }
            dataInputsContainer.innerHTML = '';
            for (let i = 0; i < numData; i++) {
                const div = document.createElement('div');
                div.className = 'flex items-center gap-2 mb-2';
                div.innerHTML = `
                    <label class="text-gray-600 dark:text-gray-400 text-sm font-medium w-16">Data ${i + 1}:</label>
                    <input type="number" placeholder="X" class="x-input shadow-sm appearance-none border border-gray-300 dark:border-gray-600 dark:bg-slate-700 dark:text-gray-200 rounded-lg w-[37%] py-2 px-3 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-500 transition" step="any">
                    <input type="number" placeholder="Y" class="y-input shadow-sm appearance-none border border-gray-300 dark:border-gray-600 dark:bg-slate-700 dark:text-gray-200 rounded-lg w-[37%] py-2 px-3 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-500 transition" step="any">
                `;
                dataInputsContainer.appendChild(div);
            }
        }

        function calculateRegression() {
            const xInputs = document.querySelectorAll('.x-input');
            const yInputs = document.querySelectorAll('.y-input');
            const x = Array.from(xInputs).map(input => parseFloat(input.value));
            const y = Array.from(yInputs).map(input => parseFloat(input.value));
            const n = x.length;

            let sum_x = 0, sum_y = 0, sum_xy = 0, sum_x2 = 0;
            for (let i = 0; i < n; i++) {
                if (isNaN(x[i]) || isNaN(y[i])) {
                    showMessageBox('Harap masukkan angka valid untuk semua data.');
                    return;
                }
                sum_x += x[i];
                sum_y += y[i];
                sum_xy += x[i] * y[i];
                sum_x2 += x[i] * x[i];
            }

            const denominator = (n * sum_x2 - sum_x * sum_x);
            if (denominator === 0) {
                showMessageBox('Tidak dapat menghitung regresi. Semua nilai X sama.');
                return;
            }

            const b = (n * sum_xy - sum_x * sum_y) / denominator;
            const a = (sum_y - b * sum_x) / n;

            regressionEquationSpan.textContent = `y = ${a.toFixed(5)} + ${b.toFixed(5)}x`;
            interceptASpan.textContent = a.toFixed(5);
            slopeBSpan.textContent = b.toFixed(5);
            
            lastChartData = { x, y, a, b };
            updateChart(x, y, a, b);
            generateConclusion(a, b); // Panggil fungsi untuk membuat kesimpulan
        }
        
        function generateConclusion(a, b) {
            let relationshipType = '';
            let relationshipEffect = '';

            // Menentukan jenis hubungan berdasarkan nilai slope (b)
            if (b > 0.0001) {
                relationshipType = 'positif';
                relationshipEffect = `meningkatkan nilai Y kurang lebih sebesar <strong class="text-green-600 dark:text-green-400">${b.toFixed(4)}</strong>`;
            } else if (b < -0.0001) {
                relationshipType = 'negatif';
                relationshipEffect = `menurunkan nilai Y kurang lebih sebesar <strong class="text-red-600 dark:text-red-400">${Math.abs(b).toFixed(4)}</strong>`;
            } else {
                relationshipType = 'sangat lemah atau tidak signifikan';
                relationshipEffect = 'hampir tidak mengubah nilai Y';
            }

            // Membuat teks kesimpulan
            conclusionTextEl.innerHTML = `
                <p>Model regresi yang terbentuk adalah <strong class="text-gray-900 dark:text-white">y = ${a.toFixed(4)} + ${b.toFixed(4)}x</strong>. Ini mengindikasikan adanya hubungan <strong>${relationshipType}</strong> antara variabel X dan Y.</p>
                <p>Secara ringkas, setiap kenaikan <strong>1 nilai/angka</strong> pada variabel X, maka diperkirakan akan ${relationshipEffect}.</p>
                <p>Nilai intercept (a) sebesar <strong class="text-gray-900 dark:text-white">${a.toFixed(4)}</strong> merupakan nilai prediksi untuk Y ketika variabel X bernilai 0.</p>
            `;

            conclusionSection.classList.remove('hidden'); // Tampilkan bagian kesimpulan
        }
        
        function predictValue() {
            const xPredict = parseFloat(xPredictInput.value);
            const a = parseFloat(interceptASpan.textContent);
            const b = parseFloat(slopeBSpan.textContent);

            if (isNaN(xPredict)) {
                showMessageBox('Masukkan nilai X untuk prediksi.');
                return;
            }
            if (isNaN(a) || isNaN(b) || (a === 0 && b === 0)) {
                showMessageBox('Hitung regresi terlebih dahulu.');
                return;
            }

            const yPredict = a + b * xPredict;
            yPredictionSpan.textContent = yPredict.toFixed(5);
        }

        function updateChart(xData, yData, a, b) {
            const isDarkMode = htmlElement.classList.contains('dark');
            const themeColors = {
                grid: isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)',
                ticks: isDarkMode ? '#cbd5e1' : '#666',
                labels: isDarkMode ? '#e2e8f0' : '#333'
            };

            const dataPoints = xData.map((val, index) => ({ x: val, y: yData[index] }));
            const minX = xData.length > 0 ? Math.min(...xData) : 0;
            const maxX = xData.length > 0 ? Math.max(...xData) : 10;
            const regressionLinePoints = [
                { x: minX, y: a + b * minX },
                { x: maxX, y: a + b * maxX }
            ];

            if (regressionChart) {
                regressionChart.destroy();
            }

            regressionChart = new Chart(chartCanvas.getContext('2d'), {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Titik Data',
                        data: dataPoints,
                        backgroundColor: 'rgba(59, 130, 246, 0.8)',
                        borderColor: 'rgba(37, 99, 235, 1)',
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBorderWidth: 2,
                        pointBorderColor: '#fff'
                    }, {
                        label: 'Garis Regresi',
                        data: regressionLinePoints,
                        type: 'line',
                        fill: false,
                        borderColor: 'rgba(239, 68, 68, 0.8)',
                        borderWidth: 3,
                        tension: 0,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: context => `(X: ${context.parsed.x.toFixed(2)}, Y: ${context.parsed.y.toFixed(2)})`
                            }
                        },
                        legend: { labels: { color: themeColors.labels, font: { size: 14 } } }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: { display: true, text: 'Nilai Independen (X)', font: { size: 16, weight: 'bold' }, color: themeColors.labels },
                            grid: { color: themeColors.grid, borderColor: themeColors.grid },
                            ticks: { color: themeColors.ticks }
                        },
                        y: {
                            title: { display: true, text: 'Nilai Dependen (Y)', font: { size: 16, weight: 'bold' }, color: themeColors.labels },
                            grid: { color: themeColors.grid, borderColor: themeColors.grid },
                            ticks: { color: themeColors.ticks }
                        }
                    }
                }
            });
        }
        
        function resetCalculator() {
            numDataInput.value = 3;
            createDataInputFields();
            xPredictInput.value = '';
            regressionEquationSpan.textContent = 'y = a + bx';
            interceptASpan.textContent = '0.00000';
            slopeBSpan.textContent = '0.00000';
            yPredictionSpan.textContent = '0.00000';
            lastChartData = { x: [], y: [], a: 0, b: 0 };
            updateChart([], [], 0, 0);
            
            // Sembunyikan dan kosongkan kesimpulan
            conclusionTextEl.innerHTML = '';
            conclusionSection.classList.add('hidden');
        }

        // --- Inisialisasi & Event Listeners ---
        window.onload = () => {
            setIconVisibility();
            resetCalculator();
        };
        createInputsBtn.addEventListener('click', createDataInputFields);
        calculateBtn.addEventListener('click', calculateRegression);
        predictBtn.addEventListener('click', predictValue);
        resetBtn.addEventListener('click', resetCalculator);

    </script>
</body>
</html>
